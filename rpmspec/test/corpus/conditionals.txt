===============================================================================
Conditionals (%ifarch)
===============================================================================

%ifarch s390x
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifos)
===============================================================================

%ifos linux
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (ifos_statement
    condition: (os
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifnarch)
===============================================================================

%ifnarch x86_64
BuildRequires:  magic
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with simple macros)
===============================================================================

%if %{defined with_foo}
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (defined_operator
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with complex macros)
===============================================================================

%if %{defined with_foo} && %{undefined with_bar}
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (binary_expression
      left: (defined_operator
        (identifier))
      right: (defined_operator
        (identifier)))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with string comparison)
===============================================================================

%if "%{optimize_flags}" != "none"
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (binary_expression
      left: (quoted_string
        (macro_expansion
          (identifier)))
      right: (quoted_string
        (string_content)))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with mathematical comparison)
===============================================================================

%if 0%{?fedora} > 10 || 0%{?rhel} > 7
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (binary_expression
      left: (binary_expression
        left: (concatenation
          (integer)
          (macro_expansion
            (conditional_expansion
              condition: (identifier))))
        right: (integer))
      right: (binary_expression
        left: (concatenation
          (integer)
          (macro_expansion
            (conditional_expansion
              condition: (identifier))))
        right: (integer)))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with expansion)
===============================================================================

%if 0%{?fedora}
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (concatenation
      (integer)
      (macro_expansion
        (conditional_expansion
          condition: (identifier))))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with paranthesis)
===============================================================================

%if (0%{?fedora} || 0%{?rhel} > 7)
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (parenthesized_expression
      (binary_expression
        left: (concatenation
          (integer)
          (macro_expansion
            (conditional_expansion
              condition: (identifier))))
        right: (binary_expression
          left: (concatenation
            (integer)
            (macro_expansion
              (conditional_expansion
                condition: (identifier))))
          right: (integer))))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%if with %else)
===============================================================================

%if 0%{?fedora}
BuildRequires:  foo
%else
BuildRequires:  bar
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (concatenation
      (integer)
      (macro_expansion
        (conditional_expansion
          condition: (identifier))))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))
    alternative: (else_clause
      body: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))))

===============================================================================
Conditionals (%if with %elif)
===============================================================================

%if 0%{?fedora}
BuildRequires:  foo
%elif 0%{?rhel}
BuildRequires:  bar
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (concatenation
      (integer)
      (macro_expansion
        (conditional_expansion
          condition: (identifier))))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))
    alternative: (elif_clause
      condition: (concatenation
        (integer)
        (macro_expansion
          (conditional_expansion
            condition: (identifier))))
      consequence: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))))

===============================================================================
Conditionals (%if with %elif and %else)
===============================================================================

%if 0%{?fedora}
BuildRequires:  foo
%elif 0%{?rhel}
BuildRequires:  bar
%else
BuildRequires:  wurst
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (concatenation
      (integer)
      (macro_expansion
        (conditional_expansion
          condition: (identifier))))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))
    alternative: (elif_clause
      condition: (concatenation
        (integer)
        (macro_expansion
          (conditional_expansion
            condition: (identifier))))
      consequence: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))
    alternative: (else_clause
      body: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))))

===============================================================================
Conditionals (%if %{with ..})
===============================================================================

%if %{with libwbclient}
Requires(post): libwbclient
%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (with_operator
      (identifier))
    consequence: (preamble
      (dependency_tag
        (qualifier))
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifnarch with negation)
===============================================================================

%ifnarch i386 i686
BuildRequires:  foo
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (identifier)
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifnos with negation)
===============================================================================

%ifnos windows
BuildRequires:  linux-only-package
%endif

-------------------------------------------------------------------------------

(spec
  (ifos_statement
    condition: (os
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifos with simple macro expansion)
===============================================================================

%ifos %myos
BuildRequires:  os-specific-package
%endif

-------------------------------------------------------------------------------

(spec
  (ifos_statement
    condition: (os
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifarch with macro expressions)
===============================================================================

%ifarch %{ix86} x86_64
BuildRequires:  arch-specific-package
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (macro_expansion
        (identifier))
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%ifnarch with simple macro expansion)
===============================================================================

%ifnarch %ix86
BuildRequires:  bpftool
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))))

===============================================================================
Conditionals (%elifarch support)
===============================================================================

%ifarch x86_64
BuildRequires:  x86_64-package
%elifarch aarch64
BuildRequires:  aarch64-package
%else
BuildRequires:  generic-package
%endif

-------------------------------------------------------------------------------

(spec
  (ifarch_statement
    condition: (arch
      (identifier))
    consequence: (preamble
      (dependency_tag)
      value: (dependency
        name: (word)))
    alternative: (elifarch_clause
      condition: (word)
      consequence: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))
    alternative: (else_clause
      body: (preamble
        (dependency_tag)
        value: (dependency
          name: (word))))))

===============================================================================
Conditionals (%if with runtime scriptlet after shell section)
===============================================================================

%check
make test

%if !%{with testsuite}
%post
%systemd_post samba.service
%endif

-------------------------------------------------------------------------------

(spec
  (check_scriptlet
    (section_check)
    (script_block
      (script_line
        (script_content))))
  (if_statement
    condition: (unary_expression
      argument: (with_operator
        (identifier)))
    consequence: (runtime_scriptlet
      (script_block
        (script_line
          (macro_simple_expansion
            (simple_macro))
          (script_content))))))

===============================================================================
Conditionals (%if with nested %files sections)
===============================================================================

%if %{with feature_x}
%files x
/usr/bin/x

%if %{with feature_y}
%files y
/usr/bin/y
%endif

%endif

-------------------------------------------------------------------------------

(spec
  (if_statement
    condition: (with_operator
      (identifier))
    consequence: (files
      name: (identifier)
      (file
        (path))
      (if_statement
        condition: (with_operator
          (identifier))
        consequence: (files
          name: (identifier)
          (file
            (path)))))))

===============================================================================
Conditionals (%if with scriptlet after %files section)
===============================================================================

%files passkey
/usr/bin/passkey

%if %{use_sssd_user}
%pre common
echo hello
%endif

-------------------------------------------------------------------------------

(spec
  (files
    name: (identifier)
    (file
      (path)))
  (if_statement
    condition: (macro_expansion
      (identifier))
    consequence: (runtime_scriptlet
      name: (identifier)
      (script_block
        (script_line
          (script_content))))))
